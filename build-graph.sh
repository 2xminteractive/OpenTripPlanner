
JVM_MAX_MEMORY="2600m"

#DEBUG="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,address=8765,suspend=y"
#DEBUG="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,address=8765,suspend=n"
DEBUG=""

JAVA_OPTS="-Xmx$JVM_MAX_MEMORY -server -XX:+UseCompressedOops $DEBUG"

if [ "$OTP_HOME" = "" ]; then
	OTP_HOME=`pwd`
fi

find . -name Graph.obj -delete
rm -rf /tmp/graph-builder/*

VERSION=`ls -1 $OTP_HOME/opentripplanner-graph-builder/target/opentripplanner-graph-builder-*.jar | tail -1 | awk -F'opentripplanner-graph-builder-' '{print $NF}' | awk -F'.jar' '{print $1}'`

cd opentripplanner-graph-builder/target
java $JAVA_OPTS -jar graph-builder.jar ../../opentripplanner-integration/src/main/resources/graph-builder.xml
mv target/graph-bundle/Graph.obj $OTP_HOME/opentripplanner-integration/target/graph-bundle/Graph.obj

#cd $OTP_HOME/opentripplanner-integration && java $JAVA_OPTS -classpath $OTP_HOME/opentripplanner-integration/target/classes:$OTP_HOME/opentripplanner-graph-builder/target/opentripplanner-graph-builder-$VERSION.jar:$OTP_HOME/opentripplanner-routing/target/opentripplanner-routing-$VERSION.jar:$HOME/.m2/repository/org/hibernate/hibernate-core/3.3.2.GA/hibernate-core-3.3.2.GA.jar:$HOME/.m2/repository/antlr/antlr/2.7.6/antlr-2.7.6.jar:$HOME/.m2/repository/commons-collections/commons-collections/3.1/commons-collections-3.1.jar:$HOME/.m2/repository/dom4j/dom4j/1.6.1/dom4j-1.6.1.jar:$HOME/.m2/repository/xml-apis/xml-apis/1.0.b2/xml-apis-1.0.b2.jar:$HOME/.m2/repository/javax/transaction/jta/1.1/jta-1.1.jar:$HOME/.m2/repository/javassist/javassist/3.8.0.GA/javassist-3.8.0.GA.jar:$HOME/.m2/repository/org/xerial/sqlite-jdbc/3.6.16/sqlite-jdbc-3.6.16.jar:$HOME/.m2/repository/org/xerial/thirdparty/nestedvm/1.0/nestedvm-1.0.jar:$HOME/.m2/repository/org/springframework/spring-context/3.0.5.RELEASE/spring-context-3.0.5.RELEASE.jar:$HOME/.m2/repository/org/springframework/spring-expression/3.0.5.RELEASE/spring-expression-3.0.5.RELEASE.jar:$HOME/.m2/repository/org/springframework/spring-asm/3.0.5.RELEASE/spring-asm-3.0.5.RELEASE.jar:$HOME/.m2/repository/org/springframework/spring-aop/3.0.5.RELEASE/spring-aop-3.0.5.RELEASE.jar:$HOME/.m2/repository/aopalliance/aopalliance/1.0/aopalliance-1.0.jar:$OTP_HOME/openstreetmap/target/openstreetmap-$VERSION.jar:$HOME/.m2/repository/crosby/binary/osmpbf/1.2.1/osmpbf-1.2.1.jar:$HOME/.m2/repository/com/google/protobuf/protobuf-java/2.4.1/protobuf-java-2.4.1.jar:$OTP_HOME/opentripplanner-utils/target/opentripplanner-utils-$VERSION.jar:$HOME/.m2/repository/org/apache/httpcomponents/httpclient/4.1.2/httpclient-4.1.2.jar:$HOME/.m2/repository/org/apache/httpcomponents/httpcore/4.1.2/httpcore-4.1.2.jar:$HOME/.m2/repository/org/slf4j/slf4j-log4j12/1.5.8/slf4j-log4j12-1.5.8.jar:$HOME/.m2/repository/org/slf4j/slf4j-api/1.5.8/slf4j-api-1.5.8.jar:$HOME/.m2/repository/log4j/log4j/1.2.14/log4j-1.2.14.jar:$HOME/.m2/repository/org/springframework/spring-jdbc/3.0.5.RELEASE/spring-jdbc-3.0.5.RELEASE.jar:$HOME/.m2/repository/org/springframework/spring-beans/3.0.5.RELEASE/spring-beans-3.0.5.RELEASE.jar:$HOME/.m2/repository/org/springframework/spring-core/3.0.5.RELEASE/spring-core-3.0.5.RELEASE.jar:$HOME/.m2/repository/org/springframework/spring-tx/3.0.5.RELEASE/spring-tx-3.0.5.RELEASE.jar:$HOME/.m2/repository/org/springframework/spring-orm/3.0.5.RELEASE/spring-orm-3.0.5.RELEASE.jar:$HOME/.m2/repository/org/apache/axis/axis/1.4/axis-1.4.jar:$HOME/.m2/repository/org/apache/axis/axis-jaxrpc/1.4/axis-jaxrpc-1.4.jar:$HOME/.m2/repository/commons-discovery/commons-discovery/0.4/commons-discovery-0.4.jar:$HOME/.m2/repository/commons-logging/commons-logging/1.1.1/commons-logging-1.1.1.jar:$HOME/.m2/repository/postgresql/postgresql/8.3-603.jdbc4/postgresql-8.3-603.jdbc4.jar:$HOME/.m2/repository/mysql/mysql-connector-java/5.0.5/mysql-connector-java-5.0.5.jar:$HOME/.m2/repository/org/geotools/gt-arcgrid/8.0-M4/gt-arcgrid-8.0-M4.jar:$HOME/.m2/repository/it/geosolutions/imageio-ext/imageio-ext-arcgrid/1.1.2/imageio-ext-arcgrid-1.1.2.jar:$HOME/.m2/repository/it/geosolutions/imageio-ext/imageio-ext-streams/1.1.2/imageio-ext-streams-1.1.2.jar:$HOME/.m2/repository/org/apache/commons/commons-compress/1.0/commons-compress-1.0.jar:$HOME/.m2/repository/net/java/dev/jets3t/jets3t/0.8.1/jets3t-0.8.1.jar:$HOME/.m2/repository/commons-codec/commons-codec/1.3/commons-codec-1.3.jar:$HOME/.m2/repository/commons-httpclient/commons-httpclient/3.1/commons-httpclient-3.1.jar:$HOME/.m2/repository/com/jamesmurty/utils/java-xmlbuilder/0.4/java-xmlbuilder-0.4.jar:$HOME/.m2/repository/commons-cli/commons-cli/1.2/commons-cli-1.2.jar:$HOME/.m2/repository/org/codehaus/jackson/jackson-mapper-asl/1.9.2/jackson-mapper-asl-1.9.2.jar:$HOME/.m2/repository/org/codehaus/jackson/jackson-core-asl/1.9.2/jackson-core-asl-1.9.2.jar:$HOME/.m2/repository/org/geotools/gt-coverage/8.0-M4/gt-coverage-8.0-M4.jar:$HOME/.m2/repository/org/geotools/gt-api/8.0-M4/gt-api-8.0-M4.jar:$HOME/.m2/repository/org/geotools/gt-referencing/8.0-M4/gt-referencing-8.0-M4.jar:$HOME/.m2/repository/java3d/vecmath/1.3.2/vecmath-1.3.2.jar:$HOME/.m2/repository/commons-pool/commons-pool/1.5.4/commons-pool-1.5.4.jar:$HOME/.m2/repository/org/geotools/gt-metadata/8.0-M4/gt-metadata-8.0-M4.jar:$HOME/.m2/repository/org/geotools/gt-opengis/8.0-M4/gt-opengis-8.0-M4.jar:$HOME/.m2/repository/net/java/dev/jsr-275/jsr-275/1.0-beta-2/jsr-275-1.0-beta-2.jar:$HOME/.m2/repository/com/vividsolutions/jts/1.12/jts-1.12.jar:$HOME/.m2/repository/xerces/xercesImpl/2.4.0/xercesImpl-2.4.0.jar:$HOME/.m2/repository/javax/media/jai_imageio/1.1/jai_imageio-1.1.jar:$HOME/.m2/repository/it/geosolutions/imageio-ext/imageio-ext-tiff/1.1.2/imageio-ext-tiff-1.1.2.jar:$HOME/.m2/repository/it/geosolutions/imageio-ext/imageio-ext-utilities/1.1.2/imageio-ext-utilities-1.1.2.jar:$HOME/.m2/repository/javax/media/jai_codec/1.1.3/jai_codec-1.1.3.jar:$HOME/.m2/repository/org/jaitools/jt-zonalstats/1.2.0/jt-zonalstats-1.2.0.jar:$HOME/.m2/repository/org/jaitools/jt-utils/1.2.0/jt-utils-1.2.0.jar:$HOME/.m2/repository/javax/media/jai_core/1.1.3/jai_core-1.1.3.jar:$HOME/.m2/repository/org/geotools/gt-geojson/8.0-M4/gt-geojson-8.0-M4.jar:$HOME/.m2/repository/com/googlecode/json-simple/json-simple/1.1/json-simple-1.1.jar:$HOME/.m2/repository/org/geotools/gt-geotiff/8.0-M4/gt-geotiff-8.0-M4.jar:$HOME/.m2/repository/org/geotools/gt-main/8.0-M4/gt-main-8.0-M4.jar:$HOME/.m2/repository/jdom/jdom/1.0/jdom-1.0.jar:$HOME/.m2/repository/org/geotools/gt-shapefile/8.0-M4/gt-shapefile-8.0-M4.jar:$HOME/.m2/repository/org/geotools/gt-data/8.0-M4/gt-data-8.0-M4.jar:$HOME/.m2/repository/org/geotools/gt-epsg-hsql/8.0-M4/gt-epsg-hsql-8.0-M4.jar:$HOME/.m2/repository/hsqldb/hsqldb/1.8.0.7/hsqldb-1.8.0.7.jar:$HOME/.m2/repository/org/hsqldb/hsqldb/2.0.0/hsqldb-2.0.0.jar:$HOME/.m2/repository/org/onebusaway/onebusaway-gtfs/1.3.0/onebusaway-gtfs-1.3.0.jar:$HOME/.m2/repository/org/onebusaway/onebusaway-csv-entities/1.1.0/onebusaway-csv-entities-1.1.0.jar:$HOME/.m2/repository/commons-beanutils/commons-beanutils/1.7.0/commons-beanutils-1.7.0.jar org.opentripplanner.integration.graph_builder.GraphBuilderIntegrationMain > graph_builder.out
